<div class="doc-viewer">
  <ul class="nav nav-tabs">
    <li ng-class="{active: mode == 'table'}">
      <a ng-click="mode='table'">Table</a>
    </li>
    <li ng-class="{active: mode == 'json'}">
      <a ng-click="mode='json'">JSON</a>
    </li>
  </ul>

  <div class="doc-viewer-content">
    <table class="table table-condensed" ng-show="mode == 'table'">
      <tbody>
        <!--sah added colorized rows -->
        <tr ng-repeat="field in fields" ng-style="{'background-color':row_colors[field]}">
          <!-- <tr ng-repeat="field in fields" ng-style="{'background-color':mapping[field].$$spec.row_color}"> -->

          <!-- kibi: added field-alias parameter to support column aliases in kibi-doc-table -->
          <td field-alias="field" field-name="field" field-type="mapping[field].type" width="1%" class="doc-viewer-field">
          </td>
          <td width="1%" class="doc-viewer-buttons" ng-if="filter">
            <span ng-if="mapping[field].filterable">
              <i ng-click="filter(mapping[field], flattened[field], '+')" tooltip="Filter for value" tooltip-append-to-body="1" class="fa fa-search-plus"></i>
              <i ng-click="filter(mapping[field], flattened[field],'-')" tooltip="Filter out value" tooltip-append-to-body="1" class="fa fa-search-minus"></i>
            </span>
            <span ng-if="!mapping[field].filterable" tooltip="Unindexed fields can not be searched">
              <i class="fa fa-search-plus text-muted"></i>
              <i class="fa fa-search-minus text-muted"></i>
            </span>
            <span ng-if="columns" data-test-subj="column-{{field}}">
              <!--kibi: added data-test-subj attribute for UI tests-->
              <i data-test-subj="toggle-{{field}}-column" ng-click="toggleColumn(field)" tooltip="Toggle column in table" tooltip-append-to-body="1"
                class="fa fa-columns"></i>
            </span>

          </td>

          <td>
            <i ng-if="!mapping[field] && field[0] === '_'" tooltip-placement="top" tooltip="Field names beginning with _ are not supported"
              class="fa fa-warning text-color-warning ng-scope doc-viewer-underscore"></i>
            <i ng-if="!mapping[field] && field[0] !== '_' && !showArrayInObjectsWarning(doc, field)" tooltip-placement="top" tooltip="No cached mapping for this field. Refresh field list from the Settings > Indices page"
              class="fa fa-warning text-color-warning ng-scope doc-viewer-no-mapping"></i>
            <i ng-if="showArrayInObjectsWarning(doc, field)" tooltip-placement="top" tooltip="Objects in arrays are not well supported."
              class="fa fa-warning text-color-warning ng-scope doc-viewer-object-array"></i>

            <i tooltip-placement="top" tooltip="Edit field color" ng-click="c.$show()" ng-hide="c.$visible" class="ng-scope">
                  <ng-md-icon icon="mode_edit" size="16" style="fill: #b4bcc2">
                    <!-- #2196F3 -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16">
                      <path d="M16.56 8.94L7.62 0 6.21 1.41l2.38 2.38-5.15 5.15c-.59.59-.59 1.54 0 2.12l5.5 5.5c.29.29.68.44 1.06.44s.77-.15 1.06-.44l5.5-5.5c.59-.58.59-1.53 0-2.12zM5.21 10L10 5.21 14.79 10H5.21zM19 11.5s-2 2.17-2 3.5c0 1.1.9 2 2 2s2-.9 2-2c0-1.33-2-3.5-2-3.5z"
                      />
                      <path fill-opacity=".36" d="M0 20h24v4H0z" />
                    </svg>
                  </ng-md-icon>
                </i>
            <div class="popover-wrapper">
              <!--<div class="editable-error help-block" data-ng-if="$edit_error" data-ng-bind="$edit_error"></div>-->
              <div style="display:none" class="doc-viewer-value ng-scope" editable-text="row_colors[field]" e-form="c" onbeforesave="checkColor($data,field,$index)"
                ng-bind-html="row_colors[field]"></div>
            </div>



            <!-- added sah set color for field" -->

            <!-- added sah ng-click="editColumn($index)" -->
            <i ng-if="field.charAt(0)!=='_' && field.charAt(0)!=='@'" tooltip-placement="top" tooltip="Edit field value" ng-click="e.$show()"
              ng-hide="e.$visible" class="ng-scope">
              <ng-md-icon icon="mode_edit" size="16" style="fill: #b4bcc2">
                <!-- #2196F3 -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16">
                  <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"></path>
                  <path d="M20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"></path>
                </svg>
              </ng-md-icon>
            </i>
            <!--https://s.codepen.io/boomerang/iFrameKey-ec7d95fd-7787-77cc-cad6-e7dfc9d306b8/index.html#-->
            <i ng-if="mapping[field].type=='geo_point'  && typeof(formatted[field]) !== 'undefined' && formatted[field].length>0" tooltip-placement="top"
              tooltip="Reverse geocode" ng-click="reverseGeocodeColumn($index)" class="ng-scope">
              <ng-md-icon icon="mode_edit" size="16" style="fill: #b4bcc2">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16">
                  <path d="M12 2C8.14 2 5 5.14 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.86-3.14-7-7-7zm-1.56 10H9v-1.44l3.35-3.34 1.43 1.43L10.44 12zm4.45-4.45l-.7.7-1.44-1.44.7-.7c.15-.15.39-.15.54 0l.9.9c.15.15.15.39 0 .54z"
                  />
                </svg>

              </ng-md-icon>
            </i>

            <i ng-if="field.indexOf('address_string')!=-1 && typeof(formatted[field]) !== 'undefined' && formatted[field].length>0" tooltip-placement="top"
              tooltip="Geocode" ng-click="geocodeColumn($index)" class="ng-scope">
              <ng-md-icon icon="mode_edit" size="16" style="fill: #b4bcc2">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16">
                  <path d="M20.5 3l-.16.03L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5c0 .28.22.5.5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5c0-.28-.22-.5-.5-.5zM15 19l-6-2.11V5l6 2.11V19z"
                  />
                </svg>
              </ng-md-icon>
            </i>
            <div class="popover-wrapper">
              <!--<div class="editable-error help-block" data-ng-if="$edit_error" data-ng-bind="$edit_error"></div>-->
              <div class="doc-viewer-value" editable-text="formatted[field]" e-form="e" onbeforesave="checkName($data,$index)" ng-bind-html="formatted[field]"></div>
            </div>

            <!--
                ng-bind-html="typeof(formatted[field]) === 'undefined' ? hit[field] : formatted[field] | trustAsHtml">
              <div class="doc-viewer-value popover-wrapper" editable-text="field" e-form="e{{$index}}" onbeforesave="checkName($index)" 
                ng-bind-html="typeof(formatted[field]) === 'undefined' ? hit[field] : formatted[field] | trustAsHtml">
              </div>
            -->
            <!---<a href="#" editable-text="field">{{ hit[field] : formatted[field] | trustAsHtml }}</a>-->
          </td>
        </tr>
      </tbody>
    </table>

    <div id="json-ace" ng-show="mode == 'json'" ng-model="hitJson" readonly ui-ace="{
          useWrapMode: true,
          onLoad: aceLoaded,
          advanced: {
            highlightActiveLine: false
          },
          rendererOptions: {
            showPrintMargin: false,
            maxLines: 4294967296
          },
          mode: 'json'
        }"></div>
  </div>
</div>